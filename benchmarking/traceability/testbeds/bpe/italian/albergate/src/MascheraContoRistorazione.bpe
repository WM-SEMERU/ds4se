▁p ackage ▁interfacce ; ▁import ▁java . io .* ; ▁import ▁java . awt .* ; ▁import ▁java . awt . event .* ; ▁import ▁common . utility .* ; ▁import ▁common . def .* ; ▁import ▁modul i .* ; ▁public ▁class ▁MascheraC ontoRistorazione ▁ext ends ▁Maschera PerAddebitare ▁{ ▁// ▁oggett i ▁per ▁la ▁costru zione ▁della ▁finestra ▁Label ▁etich 1, ▁etich 2, ▁etich 3; ▁TextField ▁num _ coperti ; ▁public ▁MascheraC ontoRistorazione ( Frame ▁parent ) ▁{ ▁super (" Servizi o ▁ristorazione ", ▁" Stampa ▁del ▁conto "); ▁padre ▁= ▁parent ; ▁padre . setEnabled ( false ); ▁iniz Extra (); ▁setupPanel lo (); ▁inizializza (); ▁pack (); ▁setVisible ( true ); ▁} ▁// ▁Tr ava so ▁dati ▁degli ▁extra ▁nell e ▁strutt ure ▁dati ▁ apposit e ▁void ▁iniz Extra () ▁{ ▁MessageDialog ▁msg ; ▁elenco _ extra ▁= ▁( Principale . db ) . menu Ristorante (); ▁if ▁( elenco _ extra ▁ != ▁null ) ▁{ ▁if ▁( extra . getItemCount () ▁> ▁0) ▁extra . removeAll (); ▁int ▁i =1; ▁while ▁( i ▁<= ▁elenco _ extra . length ()) ▁{ ▁extra . addItem ( ▁( elenco _ extra . get BeneServizio ( i )). toString () ▁ ); ▁i ++ ; ▁} ▁} ▁} ▁// ▁Crea zione ▁della ▁finestra ▁void ▁setupPanel lo () ▁{ ▁num _ coperti ▁= ▁new ▁TextField ("", ▁4 ); ▁num _ coperti . setEditable ( true ); ▁// ▁cre o ▁le ▁label ▁etich 1 ▁= ▁new ▁Label (" Gestione ▁degli ▁addebiti ▁"); ▁etich 1. setFont ( Configurazione Sistema . font _ titolo ); ▁etich 2 ▁= ▁new ▁Label (" Sceglie re ▁l ' extra ▁da ▁ addebitare ▁"); ▁etich 3 ▁= ▁new ▁Label (" Numero ▁di ▁coperti ▁"); ▁// ▁cre o ▁pannello ▁di ▁s inistra ▁this . remove ( panel 1); ▁panel 1 ▁= ▁new ▁Panel (); ▁panel 1. setLayout ( gridbag ); ▁ Utils . constrain ( panel 1, ▁etich 1, ▁0, ▁0, ▁ 6, ▁ 1); ▁ Utils . constrain ( panel 1, ▁etich 2, ▁0, ▁1, ▁ 6, ▁1, ▁ 10, ▁0, ▁0, ▁0) ; ▁ Utils . constrain ( panel 1, ▁extra , ▁0, ▁2, ▁ 6, ▁ 4, ▁Grid BagConstraints . BOTH , ▁Grid BagConstraints . WEST , ▁1.0, ▁1.0, ▁0, ▁20 , ▁0, ▁20 ); ▁// ▁cre o ▁pannello ▁per ▁coperti ▁this . remove ( panel 4 ); ▁panel 4 ▁= ▁new ▁Panel (); ▁panel 4. setLayout ( gridbag ); ▁ Utils . constrain ( panel 4, ▁etich 3, ▁0, ▁0, ▁1, ▁1, ▁ 5, ▁ 5, ▁ 5, ▁ 5); ▁ Utils . constrain ( panel 4, ▁num _ coperti , ▁1, ▁0, ▁1, ▁1, ▁Grid BagConstraints . NONE , ▁Grid BagConstraints . WEST , ▁1.0, ▁ 0.0, ▁ 5, ▁ 5, ▁ 5, ▁ 5); ▁// ▁aggiung o ▁il ▁pannello ▁appen a ▁crea to ▁al ▁resto ▁ Utils . constrain ( this , ▁panel 1, ▁0, ▁0, ▁1, ▁1, ▁Grid BagConstraints . VERTICAL , ▁Grid BagConstraints . WEST , ▁0. 5, ▁0. 5, ▁ 5, ▁ 5, ▁ 5, ▁ 5); ▁ Utils . constrain ( this , ▁panel 4, ▁0, ▁2, ▁1, ▁1, ▁Grid BagConstraints . VERTICAL , ▁Grid BagConstraints . WEST , ▁0. 5, ▁0. 5, ▁ 5, ▁ 5, ▁ 5, ▁ 5); ▁} ▁// ▁Per ▁la ▁gestione ▁degli ▁eventi ▁della ▁finestra ▁void ▁inizializza () ▁{ ▁conferma . a ddActionListener ( new ▁ActionListener () ▁{ ▁public ▁void ▁actionPerformed ( ActionEvent ▁e ) ▁{ ▁stampa Conto (); ▁} ▁} ); ▁addebita . a ddActionListener ( new ▁ActionListener () ▁{ ▁public ▁void ▁actionPerformed ( ActionEvent ▁e ) ▁{ ▁if ▁(! errore ()) ▁{ ▁aggiornaA video ( true ); ▁} ▁} ▁} ); ▁deaddebita . a ddActionListener ( new ▁ActionListener () ▁{ ▁public ▁void ▁actionPerformed ( ActionEvent ▁e ) ▁{ ▁if ▁(! errore ()) ▁{ ▁aggiornaA video ( false ); ▁} ▁} ▁} ); ▁extra . a ddActionListener ( new ▁ActionListener () ▁{ ▁public ▁void ▁actionPerformed ( ActionEvent ▁e ) ▁{ ▁if ▁(! errore ()) ▁{ ▁aggiornaA video ( true ); ▁} ▁} ▁} ); ▁} ▁// ▁Ritorna ▁false ▁se ▁si ▁sta ' ▁cerca ndo ▁di ▁ addebitare ▁un ▁extra ▁in ▁// ▁ma nc anza ▁dei ▁dati ▁necessari ▁per ▁l ' addebito : ▁coperti ▁e ▁extra . ▁boolean ▁errore () ▁{ ▁Frame ▁msg ; ▁if ▁( ( num _ coperti . getText ()). equals ("")) ▁{ ▁msg ▁= ▁new ▁MessageDialog ( this , ▁" Inseri re ▁il ▁numero ▁di ▁coperti !" ); ▁return ▁true ; ▁} ▁else ▁if ▁( ▁! Utils . is Int Pos ( num _ coperti . getText ()) ▁) ▁{ ▁msg ▁= ▁new ▁MessageDialog ( this , ▁" I l ▁numero ▁dei ▁coperti ▁deve ▁essere ▁un ▁numero ▁intero !" ); ▁return ▁true ; ▁} ▁else ▁if ▁( extra . getSelectedIndex () ▁== ▁-1) ▁{ ▁msg ▁= ▁new ▁MessageDialog ( this , ▁" Man ca ▁selezione !" ); ▁return ▁true ; ▁} ▁else ▁return ▁false ; ▁} ▁int ▁pos Extra In Addebiti ( BeneServizio ▁b ) ▁{ ▁for ▁( int ▁i ▁= ▁1; ▁i ▁<= ▁elenco _ addebiti . length (); ▁i ++) ▁if ▁( ▁( ( elenco _ addebiti . get Addebito ( i )). get Cod Extra ()). equals ( b . get Cod Extra ()) ▁) ▁return ▁i ; ▁return ▁ -1; ▁} ▁void ▁aggiornaA video ( boolean ▁addebito ) ▁{ ▁Frame ▁msg ; ▁int ▁supp []; ▁BeneServizio ▁extra _ scelto ▁= ▁elenco _ extra . get BeneServizio ( ▁extra . getSelectedIndex () ▁+ ▁1 ▁ ); ▁int ▁pos ; ▁if ▁( ( pos ▁= ▁pos Extra In Addebiti ( extra _ scelto )) ▁< ▁0 ▁&& ▁addebito ) ▁{ ▁Addebito ▁a ▁= ▁new ▁Addebito (" RIST ", ▁extra _ scelto . get Cod Extra (), ▁0, ▁0) ; ▁elenco _ addebiti . add Addebito ( ▁a ▁ ); ▁elenco _ extra _ addebitati . add BeneServizio ( ▁extra _ scelto ▁ ); ▁// ▁all ung o ▁l ' array ▁delle ▁quantita ' ▁modificate ▁supp ▁= ▁new ▁int [ elenco _ addebiti . length () ]; ▁for ▁( int ▁i ▁= ▁0; ▁i < quantita _ mod . length ; ▁i ++) ▁supp [ i ] ▁= ▁quantita _ mod [ i ]; ▁supp [ supp . length ▁- ▁1] ▁= ▁1; ▁quantita _ mod ▁= ▁supp ; ▁pos ▁= ▁quantita _ mod . length ; ▁extra _ add . setText ( extra . getSelectedItem ()); ▁continu a Aggiornamento (); ▁} ▁else ▁{ ▁if ▁( pos ▁< ▁0) ▁{ ▁// ▁s to ▁cerca ndo ▁di ▁to glie re ▁da ▁un ▁addebito ▁inesistente ▁msg ▁= ▁new ▁Avviso Dialog ( this , ▁" Sta i ▁cerca ndo ▁di ▁to glie re ▁da ▁un ▁addebito ▁ orma i ▁inesistente !" ); ▁} ▁else ▁{ ▁// ▁ aggiorn o ▁ tale ▁array ▁per ▁con tenere ▁l ' addebito ▁appen a ▁effettuato ▁if ▁( addebito ) ▁{ ▁quantita _ mod [ pos ▁- ▁1] ++ ; ▁extra _ add . setText ( extra . getSelectedItem ()); ▁continu a Aggiornamento (); ▁} ▁else ▁if ▁( ▁quantita _ mod [ pos ▁- ▁1] ▁> ▁0) ▁{ ▁quantita _ mod [ pos ▁- ▁1] -- ; ▁extra _ add . setText ( extra . getSelectedItem ()); ▁continu a Aggiornamento (); ▁} ▁else ▁msg ▁= ▁new ▁Avviso Dialog ( this , ▁" Sta i ▁cerca ndo ▁di ▁to glie re ▁da ▁un ▁addebito ▁ orma i ▁inesistente !" ); ▁} ▁} ▁} ▁void ▁continu a Aggiornamento () ▁{ ▁int ▁i ▁= ▁1; ▁BeneServizio ▁e ; ▁float ▁conto ▁= ▁0; ▁float ▁conto _ di _ questo _ extra ; ▁if ▁( addebiti . getItemCount () ▁> ▁0) ▁addebiti . removeAll (); ▁while ▁( ▁i ▁<= ▁elenco _ addebiti . length () ▁) ▁{ ▁if ▁( quantita _ mod [ i -1] ▁ != ▁0) ▁{ ▁e ▁= ▁elenco _ extra _ addebitati . get BeneServizio ( i ); ▁conto _ di _ questo _ extra ▁= ▁quantita _ mod [ i -1] * e . getP xUnit ario (); ▁if ▁( ▁Integer . parse Int ( e . get Cod Extra ()) ▁>= ▁ 40000000 ▁&& ▁Integer . parse Int ( e . get Cod Extra ()) ▁< ▁ 50000000 ) ▁addebiti . addItem (" S ▁"+ Utils . completa Stringa ( e . getDescrizione (), ▁32) +" ▁"+( Principale . config ) . get Valuta ()+"."+ ( elenco _ addebiti . get Addebito ( i )). getTot Addebito ()); ▁else ▁if ▁( ▁Integer . parse Int ( e . get Cod Extra ()) ▁>= ▁ 50000000 ) ▁addebiti . addItem (" R ▁"+ Utils . completa Stringa ( e . getDescrizione (), ▁32) +" ▁"+( Principale . config ) . get Valuta ()+"."+ ( elenco _ addebiti . get Addebito ( i )). getTot Addebito ()); ▁else ▁addebiti . addItem ( ▁ Utils . completa Stringa ( e . getDescrizione (), 10)+ Utils . completa Stringa (" ▁ x ▁"+ quantita _ mod [ i -1] , ▁5)+ ( Principale . config ) . get Valuta ()+"."+ conto _ di _ questo _ extra ▁ ); ▁conto ▁= ▁conto ▁+ ▁conto _ di _ questo _ extra ; ▁} ▁i ++ ; ▁} ▁totale . setText ( ( Principale . config ) . get Valuta ()+"."+ conto ); ▁} ▁void ▁stampa Conto () ▁{ ▁if ▁(! errore ()) ▁{ ▁write File (); ▁dispose (); ▁padre . setEnabled ( true ); ▁} ▁} ▁private ▁void ▁write File () ▁{ ▁Frame ▁msg ; ▁float ▁costo _ coperti ; ▁ DataOutputStream ▁outStream ; ▁try ▁{ ▁outStream ▁= ▁new ▁ DataOutputStream ( new ▁ FileOutputStream (" conto . a b g ") ); ▁} ▁catch ▁( IOException ▁ex ) ▁{ ▁msg ▁= ▁new ▁MessageDialog ( this ," Errore ▁nell ' a pertura ▁del ▁file ▁del ▁conto "); ▁return ; ▁} ▁try ▁{ ▁outStream . writeB ytes ( ▁( Principale . config ) . getNomeA lbergo ()+" \ n " ▁ ); ▁outStream . writeB ytes ( ▁" \ n " ▁ ); ▁outStream . writeB ytes ( ▁( Principale . config ) . get Rag Soc ()+" \ n " ▁ ); ▁outStream . writeB ytes ( ▁( Principale . config ) . getIndirizzo Alb ()+" \ n " ▁ ); ▁outStream . writeB ytes ( ▁( Principale . config ) . getComune Alb ()+" \ n " ▁ ); ▁outStream . writeB ytes ( ▁( Principale . config ) . getCitta Alb ()+" \ n " ▁ ); ▁outStream . writeB ytes ( ▁" \ n " ▁ ); ▁BeneServizio ▁extra ; ▁Addebito ▁a ; ▁int ▁num ; ▁String ▁supporto ; ▁float ▁conto _ totale ; ▁for ( int ▁i =1; ▁i <= elenco _ addebiti . length (); ▁i ++) ▁{ ▁if ▁( quantita _ mod [ i -1] ▁ != ▁0) ▁{ ▁a ▁= ▁elenco _ addebiti . get Addebito ( i ); ▁extra ▁= ▁elenco _ extra _ addebitati . get BeneServizio ( i ); ▁num ▁= ▁quantita _ mod [ i -1] ; ▁if ▁( ▁( extra . get Cod Extra ()). compar eTo (" 40000000 ") ▁< ▁0 ▁) ▁supporto ▁= ▁new ▁String ( extra . getDescrizione ()+" ▁ x ▁"+ num +" ▁"); ▁else ▁if ▁( ▁( extra . get Cod Extra ()). compar eTo (" 50000000 ") ▁< ▁0 ▁) ▁supporto ▁= ▁new ▁String (" Supplemento ▁per ▁"+ extra . getDescrizione ()+" ▁"); ▁else ▁supporto ▁= ▁new ▁String (" Riduzione ▁per ▁"+ extra . getDescrizione ()+" ▁"); ▁while ▁( supporto . length () ▁< ▁52) ▁supporto ▁= ▁new ▁String ( supporto +" ▁"); ▁outStream . writeB ytes ( supporto +( Principale . config ) . get Valuta ()+"."+ ▁num * extra . getP xUnit ario ()+" \ n " ▁ ); ▁} ▁} ▁supporto ▁= ▁new ▁String (" Coperto ▁ x ▁"+ num _ coperti . getText ()); ▁while ▁( supporto . length () ▁< ▁52) ▁supporto ▁= ▁new ▁String ( supporto +" ▁"); ▁costo _ coperti ▁= ▁Integer . parse Int ( num _ coperti . getText ())* ( Principale . config ) . get Coperto (); ▁outStream . writeB ytes ( supporto +( Principale . config ) . get Valuta ()+"."+ costo _ coperti +" \ n "); ▁outStream . writeB ytes (" \ n "); ▁supporto ▁= ▁new ▁String (" Totale "); ▁while ▁( supporto . length () ▁< ▁52) ▁supporto ▁= ▁new ▁String ( supporto +" ▁"); ▁conto _ totale ▁= ▁( Float . valueOf ( ▁new ▁String ( ( totale . getText ()). substring ( 2) ) ▁) ) . float Value ()+ costo _ coperti ; ▁outStream . writeB ytes ( ▁supporto +( Principale . config ) . get Valuta ()+"."+ conto _ totale ▁ ); ▁outStream . close (); ▁} ▁catch ▁( IOException ▁ex ) ▁{ ▁msg ▁= ▁new ▁MessageDialog ( this ," Errore ▁nella ▁scritt ura ▁del ▁file ▁del ▁conto "); ▁return ; ▁} ▁} ▁}