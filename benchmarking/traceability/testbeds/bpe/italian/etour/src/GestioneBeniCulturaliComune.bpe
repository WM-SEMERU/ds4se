▁ ï»¿ p ackage ▁unisa . gps . etour . control . Gestione BeniCulturali ; ▁import ▁java . rmi . RemoteException ; ▁import ▁java . rmi . server . Uni castRemoteObject ; ▁import ▁java . sql . SQLException ; ▁import ▁java . util . ArrayList ; ▁import ▁java . util . Date ; ▁import ▁java . util . HashMap ; ▁import ▁unisa . gps . etour . bean . Bean BeneCulturale ; ▁import ▁unisa . gps . etour . bean . BeanTag ; ▁import ▁unisa . gps . etour . bean . BeanVisitaBC ; ▁import ▁unisa . gps . etour . repository . DBTag ; ▁/ ▁/ ▁import ▁unisa . gps . etour . repository . DBBeneCulturale ; ▁/ ▁/ ▁import ▁unisa . gps . etour . repository . DBTurista ; ▁/ ▁/ ▁import ▁unisa . gps . etour . repository . DBVisitaBC ; ▁import ▁unisa . gps . etour . repository . IDBBeneCulturale ; ▁import ▁unisa . gps . etour . repository . IDBTag ; ▁import ▁unisa . gps . etour . repository . IDBTurista ; ▁import ▁unisa . gps . etour . repository . IDBVisitaBC ; ▁import ▁unisa . gps . etour . util . CostantiGlobali ; ▁import ▁unisa . gps . etour . util . MessaggiErrore ; ▁/ ▁/ ▁Stub ▁import ▁unisa . gps . etour . control . Gestione BeniCulturali . test . stub . DBBeneCulturale ▁/ ▁/ ▁*** ▁import ▁unisa . gps . etour . control . Gestione BeniCulturali . test . stub . DBTurista ▁/ ▁/ ▁*** ▁import ▁unisa . gps . etour . control . Gestione BeniCulturali . test . stub . DBVisitaBC ▁/ ▁/ ▁*** ▁/ ▁** ▁* ▁Class ▁management ▁of ▁cultural ▁heritage ▁for ▁operations ▁common ▁to ▁all ▁a ctors ▁* ▁* ▁@ ▁Auth or ▁Mich e langelo ▁De ▁Sim one ▁* ▁@ ▁Version ▁0.1 ▁* ▁* ▁ Â© ▁ 2007 ▁eTour ▁Project ▁- ▁Copy right ▁by ▁DMI ▁SE ▁@ ▁ SA ▁Lab ▁- ▁University ▁of ▁Salerno ▁* ▁/ ▁/ ▁** ▁* ▁* ▁/ ▁Gestione BeniCulturali Comune ▁Uni castRemoteObject ▁public ▁class ▁ext ends ▁implements ▁IGestione BeniCulturali Comune ▁( ▁/ ▁/ ▁Connect ▁to ▁DB ▁for ▁Cultural ▁Heritage ▁prot ected ▁ IDBBeneCulturale ▁dbbc ; ▁/ ▁/ ▁Connect ▁to ▁DB ▁Tag ▁prot ected ▁IDBTag ▁dbtag ; ▁/ ▁/ ▁Connect ▁to ▁DB ▁for ▁the ▁Feedback ▁/ ▁Visit s ▁prot ected ▁IDBVisitaBC ▁dbvisita ; ▁/ ▁/ ▁Connect ▁to ▁DB ▁for ▁Tourists ▁prot ected ▁IDBTurista ▁dbturista ; ▁/ ▁** ▁* ▁Constructor ; ▁you ▁instantiate ▁all ▁fields ▁relevan t ▁to ▁data ▁management ; ▁* ▁ Fields ▁are ▁initialize d ▁for ▁each ▁instance ▁of ▁the ▁class . ▁* ▁* ▁@ ▁Throw s ▁RemoteException ▁Exception ▁flow ▁* ▁/ ▁public ▁Gestione BeniCulturali Comune ▁() ▁throws ▁RemoteException ▁( ▁/ ▁/ ▁Class ▁Super c ostruttore ▁Uni castRemoteObject ▁super ▁(); ▁/ ▁/ ▁We ▁instantiate ▁objects ▁TR Y ▁( ▁dbbc ▁= ▁new ▁ DBBeneCulturale ▁(); ▁dbtag ▁= ▁new ▁ DBTag ▁(); ▁dbvisita ▁= ▁new ▁ DBVisitaBC ▁(); ▁dbturista ▁= ▁new ▁ DBTurista ▁(); ▁) ▁catch ▁( Exception ▁e ) ▁( ▁throw ▁new ▁RemoteException ▁( MessaggiErrore . ERRORE _ SCONOSCIUTO ); ▁) ▁) ▁/ ▁* ▁* ▁Implement s ▁the ▁method ▁for ▁obtain ing ▁a ▁cultural ▁object ▁by ▁Id ▁* ▁* ▁@ ▁Se e ▁unisa . gps . etour . control . Gestione BeniCulturali . IGestione BeniCulturali Comune ▁# ▁ottieni BeneCulturale ▁( int ) ▁* ▁/ ▁public ▁Bean BeneCulturale ▁ottieni BeneCulturale ▁( int ▁ pBeneCulturaleID ) ▁throws ▁RemoteException ▁( ▁if ▁(! ▁Controllo BeniCulturali . controllaId BeneCulturale ▁( pBeneCulturaleID )) ▁throw ▁new ▁RemoteException ▁( MessaggiErrore . ERRORE _ DATI ); ▁B BC ▁Bean BeneCulturale ▁= ▁null ; ▁TR Y ▁( ▁ bbc ▁= ▁dbbc . ottieni BeneCulturale ▁( pBeneCulturaleID ); ▁) ▁catch ▁( SQLException ▁e ) ▁( ▁throw ▁new ▁RemoteException ▁( MessaggiErrore . ERRORE _ DBMS ); ▁) ▁catch ▁( Exception ▁e ) ▁( ▁throw ▁new ▁RemoteException ▁( MessaggiErrore . ERRORE _ SCONOSCIUTO ); ▁) ▁ bbc ▁return ; ▁) ▁/ ▁* ▁* ▁Implement s ▁the ▁method ▁for ▁obtain ing ▁all ▁the ▁tags ▁of ▁a ▁cultural ▁object . ▁* ▁* ▁@ ▁Se e ▁unisa . gps . etour . control . Gestione BeniCulturali . IGestione BeniCulturali Comune ▁# ▁ottieniTag BeneCulturale ▁( int ) ▁* ▁/ ▁< BeanTag > ▁ottieniTag BeneCulturale ▁public ▁ArrayList ▁( int ▁ pBeneCulturaleID ) ▁throws ▁RemoteException ▁( ▁if ▁(! ▁Controllo BeniCulturali . controllaId BeneCulturale ▁( pBeneCulturaleID )) ▁throw ▁new ▁RemoteException ▁( MessaggiErrore . ERRORE _ DATI ); ▁ArrayList ▁< BeanTag > ▁ btag ▁= ▁null ; ▁TR Y ▁( ▁ btag ▁= ▁dbtag . ottieniTag BeneCulturale ▁( pBeneCulturaleID ); ▁) ▁catch ▁( SQLException ▁e ) ▁( ▁throw ▁new ▁RemoteException ▁( MessaggiErrore . ERRORE _ DBMS ); ▁) ▁catch ▁( Exception ▁e ) ▁( ▁throw ▁new ▁RemoteException ▁( MessaggiErrore . ERRORE _ SCONOSCIUTO ); ▁) ▁ btag ▁return ; ▁) ▁/ ▁* ▁* ▁Implement s ▁the ▁method ▁to ▁obtain ▁the ▁list ▁of ▁feedback ▁and ▁the ir ▁username ▁on ▁a ▁property ▁* ▁Cultural ▁specified ▁by ▁Id ▁* ▁* ▁@ ▁Se e ▁unisa . gps . etour . control . Gestione BeniCulturali . IGestione BeniCulturali Comune ▁# ▁ottieniFeedback BeneCulturale ▁( int ) ▁* ▁/ ▁< BeanVisitaBC , ▁String > ▁ottieniFeedback BeneCulturale ▁public ▁ HashMap ▁( int ▁ pBeneCulturaleID ) ▁throws ▁RemoteException ▁( ▁if ▁(! ▁Controllo BeniCulturali . controllaId BeneCulturale ▁( pBeneCulturaleID )) ▁throw ▁new ▁RemoteException ▁( MessaggiErrore . ERRORE _ DATI ); ▁ HashMap ▁< BeanVisitaBC , ▁String > ▁mappaRitorno ; ▁TR Y ▁( ▁/ ▁/ ▁Instantiate ▁the ▁map ▁of ▁the ▁same ▁size ▁as ▁the ▁list ▁of ▁BeanVisitaBC ▁mappaRitorno ▁= ▁new ▁ HashMap ▁< BeanVisitaBC , ▁String > ▁( dbvisita . ottieni ListaVisitaBC ▁( pBeneCulturaleID ) . ▁size ▁()); ▁/ ▁/ ▁For ▁each ▁visit ▁by ▁adding ▁the ir ▁username ▁/ ▁/ ▁ Here ▁we ▁begin ▁to ▁iterate ▁to ▁add ▁to ▁any ▁visit ▁the ir ▁username ▁for ▁( BeanVisitaBC ▁b : ▁dbvisita . ottieni ListaVisitaBC ▁( pBeneCulturaleID )) ▁mappaRitorno . put ▁( b , ▁dbturista . ottieniTurista ▁( b . get IdTurista ▁()) . ▁Get UserName ▁()); ▁) ▁catch ▁( SQLException ▁e ) ▁( ▁throw ▁new ▁RemoteException ▁( MessaggiErrore . ERRORE _ DBMS ); ▁) ▁catch ▁( Exception ▁e ) ▁( ▁throw ▁new ▁RemoteException ▁( MessaggiErrore . ERRORE _ SCONOSCIUTO ); ▁) ▁mappaRitorno ▁return ; ▁) ▁/ ▁* ▁* ▁Implement s ▁the ▁method ▁to ▁obtain ▁statistics ▁about ▁a ▁cultural ▁past ▁* ▁T hrough ▁Id ▁* ▁* ▁@ ▁Se e ▁unisa . gps . etour . control . Gestione BeniCulturali . IGestione BeniCulturali Comune ▁# ▁ottieni Statistiche BeneCulturale ▁( int ) ▁* ▁/ ▁< Integer > ▁ottieni Statistiche BeneCulturale ▁public ▁ArrayList ▁( int ▁ pBeneCulturaleID ) ▁throws ▁RemoteException ▁( ▁/ ▁* ▁* ▁ This ▁method ▁returns ▁an ▁ArrayList ▁containing ▁5 ▁elements ▁(0 ▁ . . ▁4) . ▁* ▁For ▁each ▁index ▁mo re ▁' one ▁is ▁the ▁number ▁of ▁ equiv ale nt ▁value ▁you r ▁feedback ▁* ▁ Index ▁number ▁mo re ▁' one . ▁* ▁Even ▁in ▁this ▁case ▁the ▁method ▁is ▁not ▁' p a r t ic ul a r ly ▁attr active ▁but ▁it ▁do es ▁its ▁di rty ▁work ▁* ▁Fine . ▁* ▁/ ▁if ▁(! ▁Controllo BeniCulturali . controllaId BeneCulturale ▁( pBeneCulturaleID )) ▁throw ▁new ▁RemoteException ▁( MessaggiErrore . ERRORE _ DATI ); ▁ArrayList ▁< Integer > ▁listaRisultati ▁< Integer > ▁= ▁new ▁ArrayList ▁( 5); ▁/ ▁/ ▁Set ▁all ▁the ▁indice s ▁to ▁0 ▁for ▁( int ▁i ▁= ▁0; ▁i ▁ <5; ▁i ▁+ ▁+) ▁listaRisultati . add ▁( i , ▁Integer . valueOf ▁(0) ); ▁/ ▁/ ▁ Calculate ▁the ▁date ▁for ▁the ▁last ▁thi rty ▁days ▁Date ▁ul timiTrentaGiorni ▁= ▁new ▁Date ▁( new ▁Date ▁() . ▁Get Time ▁() ▁- ▁CostantiGlobali . TR ENTA _ GIORNI ); ▁TR Y ▁( ▁/ ▁/ ▁Get ▁all ▁visits ▁of ▁a ▁certa in ▁cultural ▁/ ▁/ ▁ Loop ▁look ing ▁for ▁the ▁request s ▁/ ▁feedback ▁obtained ▁within ▁the ▁last ▁thi rty ▁days ▁for ▁( BeanVisitaBC ▁b : ▁dbvisita . ottieni ListaVisitaBC ▁( pBeneCulturaleID )) ▁if ▁( b . get DataVisita ▁() . ▁after ▁( ul timiTrentaGiorni )) ▁listaRisultati . set ▁( b . get Voto ▁() ▁- ▁1, ▁Integer . valueOf ▁( listaRisultati . get ▁( b . get Voto ▁() ▁- ▁1) . ▁intValue ▁() ▁+ ▁1) ); ▁) ▁catch ▁( SQLException ▁e ) ▁( ▁throw ▁new ▁RemoteException ▁( MessaggiErrore . ERRORE _ DBMS ); ▁) ▁catch ▁( Exception ▁e ) ▁( ▁throw ▁new ▁RemoteException ▁( MessaggiErrore . ERRORE _ SCONOSCIUTO ); ▁) ▁listaRisultati ▁return ; ▁) ▁/ ▁* ▁* ▁Implement ▁the ▁method ▁for ▁changing ▁a ▁feedback ▁on ▁a ▁cultural ▁past ▁* ▁T hrough ▁Id ▁* ▁* ▁@ ▁Se e ▁unisa . gps . etour . control . Gestione BeniCulturali . IGestione BeniCulturali Comune ▁# ▁ modificaFeedback BeneCulturale ▁( int , ▁unisa . gps . etour . bean . BeanVisitaBC ) ▁* ▁/ ▁public ▁boolean ▁ modificaFeedback BeneCulturale ▁( int ▁ pBeneCulturaleID , ▁BeanVisitaBC ▁pBeanVisitaBC ) ▁throws ▁RemoteException ▁( ▁if ▁(! ▁Controllo BeniCulturali . controllaId BeneCulturale ▁( pBeneCulturaleID ) ▁| ▁| ▁! ▁Controllo Visit e BeniCulturali . controllaDati Visita BeneCulturale ▁( pBeanVisitaBC )) ▁throw ▁new ▁RemoteException ▁( MessaggiErrore . ERRORE _ DATI ); ▁/ ▁* ▁* ▁P lease ▁check ▁that ▁the ▁vote ▁has ▁not ▁changed . ▁* ▁I f ▁the ▁vote ▁is ▁changed ▁to ▁an ▁exception ▁is ▁raise d ▁* ▁/ ▁ votoOk ▁boolean ▁= ▁true ; ▁TR Y ▁( ▁ votoOk ▁= ▁dbvisita . ottieni VisitaBC ▁( pBeneCulturaleID , ▁pBeanVisitaBC . get IdTurista ▁()) . ▁get Voto ▁() ▁== ▁pBeanVisitaBC . get Voto ▁(); ▁) ▁catch ▁( SQLException ▁e ) ▁( ▁throw ▁new ▁RemoteException ▁( MessaggiErrore . ERRORE _ DBMS ); ▁) ▁catch ▁( Exception ▁e ) ▁( ▁throw ▁new ▁RemoteException ▁( MessaggiErrore . ERRORE _ SCONOSCIUTO ); ▁) ▁/ ▁* ▁* ▁I f ▁the ▁vote ▁is ▁not ▁changed ▁we ▁proceed ▁to ▁send ▁the ▁message ▁to ▁the ▁method ▁of ▁* ▁Change ▁the ▁layer ' s ▁database . ▁* ▁/ ▁if ▁( votoOk ) ▁TR Y ▁( ▁return ▁( dbvisita . modifica VisitaBC ▁( pBeanVisitaBC )); ▁) ▁catch ▁( SQLException ▁e ) ▁( ▁throw ▁new ▁RemoteException ▁( MessaggiErrore . ERRORE _ DBMS ); ▁) ▁catch ▁( Exception ▁e ) ▁( ▁throw ▁new ▁RemoteException ▁( MessaggiErrore . ERRORE _ SCONOSCIUTO ); ▁) ▁return ▁false ; ▁) ▁)